// JavaScript autoComplete v1.0.4
// https://github.com/Pixabay/JavaScript-autoComplete
export default function(e){let t=(e,t)=>e.classList.contains(t),s=(e,s,l,o)=>{(o||document).addEventListener(s,s=>{let o,c=s.target;for(;c&&!(o=t(c,e));)c=c.parentElement;o&&l.call(c,s)})},l={selector:0,source:0,minChars:3,delay:150,offsetLeft:0,offsetTop:1,cache:1,menuClass:"",renderItem(e,t){t=t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");let s=RegExp("("+t.replace(/ /g,"|")+")","gi");return'<div class="autocomplete-suggestion" data-val="'+e+'">'+e.replace(s,"<b>$1</b>")+"</div>"},onSelect(e,t,s){},...e},o="object"==typeof l.selector?[l.selector]:document.querySelectorAll(l.selector);for(let e of o){e.sc=document.createElement("div"),e.sc.className="autocomplete-suggestions "+l.menuClass,e.autocompleteAttr=e.getAttribute("autocomplete"),e.setAttribute("autocomplete","off"),e.cache={},e.last_val="",e.updateSC=((t,s)=>{let o=e.getBoundingClientRect();if(e.sc.style.left=Math.round(o.left+(window.pageXOffset||document.documentElement.scrollLeft)+l.offsetLeft)+"px",e.sc.style.top=Math.round(o.bottom+(window.pageYOffset||document.documentElement.scrollTop)+l.offsetTop)+"px",e.sc.style.width=Math.round(o.right-o.left)+"px",!t&&(e.sc.style.display="block",e.sc.maxHeight||(e.sc.maxHeight=parseInt((window.getComputedStyle?getComputedStyle(e.sc,null):e.sc.currentStyle).maxHeight)),e.sc.suggestionHeight||(e.sc.suggestionHeight=e.sc.querySelector(".autocomplete-suggestion").offsetHeight),e.sc.suggestionHeight))if(s){let t=e.sc.scrollTop,l=s.getBoundingClientRect().top-e.sc.getBoundingClientRect().top;l+e.sc.suggestionHeight-e.sc.maxHeight>0?e.sc.scrollTop=l+e.sc.suggestionHeight+t-e.sc.maxHeight:0>l&&(e.sc.scrollTop=l+t)}else e.sc.scrollTop=0}),window.addEventListener("resize",e.updateSC),document.body.appendChild(e.sc),s("autocomplete-suggestion","mouseleave",t=>{let s=e.sc.querySelector(".autocomplete-suggestion.selected");s&&setTimeout(()=>{s.className=s.className.replace("selected","")},20)},e.sc),s("autocomplete-suggestion","mouseover",t=>{let s=e.sc.querySelector(".autocomplete-suggestion.selected");s&&(s.className=s.className.replace("selected","")),this.className+=" selected"},e.sc),s("autocomplete-suggestion","mousedown",s=>{if(t(this,"autocomplete-suggestion")){let t=this.getAttribute("data-val");e.value=t,l.onSelect(s,t,this),e.sc.style.display="none"}},e.sc),e.blurHandler=(()=>{let t;try{t=document.querySelector(".autocomplete-suggestions:hover")}catch(e){}t?e!=document.activeElement&&setTimeout(()=>{e.focus()},20):(e.last_val=e.value,e.sc.style.display="none",setTimeout(()=>{e.sc.style.display="none"},350))}),e.addEventListener("blur",e.blurHandler);let o=t=>{let s=e.value;if(e.cache[s]=t,t.length&&s.length>=l.minChars){let o="";for(let e of t)o+=l.renderItem(e,s);e.sc.innerHTML=o,e.updateSC(0)}else e.sc.style.display="none"};e.keydownHandler=(t=>{let s=t.which;if((40==s||38==s)&&e.sc.innerHTML){let t,l=e.sc.querySelector(".autocomplete-suggestion.selected");return l?(t=40==s?l.nextSibling:l.previousSibling)?(l.className=l.className.replace("selected",""),t.className+=" selected",e.value=t.getAttribute("data-val")):(l.className=l.className.replace("selected",""),e.value=e.last_val,t=0):((t=40==s?e.sc.querySelector(".autocomplete-suggestion"):e.sc.childNodes[e.sc.childNodes.length-1]).className+=" selected",e.value=t.getAttribute("data-val")),e.updateSC(0,t),!1}if(27==s)e.value=e.last_val,e.sc.style.display="none";else if(13==s||9==s){"none"!=e.sc.style.display&&t.preventDefault();let s=e.sc.querySelector(".autocomplete-suggestion.selected");s&&"none"!=e.sc.style.display&&(l.onSelect(t,s.getAttribute("data-val"),s),setTimeout(()=>{e.sc.style.display="none"},20))}}),e.addEventListener("keydown",e.keydownHandler),e.keyupHandler=(t=>{let s=window.event?t.keyCode:t.which;if(!s||(35>s||s>40)&&13!=s&&27!=s){let t=e.value;if(t.length<l.minChars)e.last_val=t,e.sc.style.display="none";else if(t!=e.last_val){if(e.last_val=t,clearTimeout(e.timer),l.cache){if(t in e.cache)return o(e.cache[t]);for(let s=1;s<t.length-l.minChars;s++){let l=t.slice(0,t.length-s);if(l in e.cache&&!e.cache[l].length)return o([])}}e.timer=setTimeout(()=>{l.source(t,o)},l.delay)}}}),e.addEventListener("keyup",e.keyupHandler),e.focusHandler=(t=>{e.last_val="\n",e.keyupHandler(t)}),l.minChars||e.addEventListener("focus",e.focusHandler)}this.destroy=(()=>{for(let e of o)window.removeEventListener("resize",e.updateSC),e.removeEventListener("blur",e.blurHandler),e.removeEventListener("focus",e.focusHandler),e.removeEventListener("keydown",e.keydownHandler),e.removeEventListener("keyup",e.keyupHandler),e.autocompleteAttr?e.setAttribute("autocomplete",e.autocompleteAttr):e.removeAttribute("autocomplete"),document.body.removeChild(e.sc);o=null})};